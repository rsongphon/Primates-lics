# PostgreSQL Development Configuration for LICS
# Optimized for development with faster restarts and debugging

# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------
max_connections = 50                    # Lower for development
superuser_reserved_connections = 3

# RESOURCE USAGE (except WAL)
#------------------------------------------------------------------------------
# Smaller memory settings for development
shared_buffers = 512MB                  # Smaller for dev environment
effective_cache_size = 1GB              # Conservative estimate
work_mem = 8MB                          # Smaller per-operation memory
maintenance_work_mem = 128MB            # For maintenance operations
autovacuum_work_mem = 128MB            # For autovacuum operations

# Kernel resource usage
max_worker_processes = 4
max_parallel_workers_per_gather = 2
max_parallel_workers = 4
max_parallel_maintenance_workers = 2

# WRITE AHEAD LOG (WAL)
#------------------------------------------------------------------------------
wal_level = minimal                     # Minimal for development
wal_buffers = 8MB                      # Smaller WAL buffer
checkpoint_completion_target = 0.7      # Faster checkpoints
max_wal_size = 1GB                     # Smaller WAL size
min_wal_size = 256MB                   # Smaller minimum
checkpoint_timeout = 5min              # More frequent checkpoints

# QUERY TUNING
#------------------------------------------------------------------------------
# Development-friendly settings
random_page_cost = 1.1                 # SSD-optimized
effective_io_concurrency = 100         # Moderate for dev
seq_page_cost = 1.0

# LOGGING
#------------------------------------------------------------------------------
# Verbose logging for development
log_destination = 'stderr'
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 10MB
log_truncate_on_rotation = on

# Log more for debugging
log_min_duration_statement = 250       # Log queries > 250ms
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
log_statement = 'all'                  # Log all statements in dev
log_temp_files = 1MB                   # Log smaller temp files
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# STATISTICS
#------------------------------------------------------------------------------
# Enhanced statistics for development
track_activities = on
track_counts = on
track_io_timing = on
track_functions = all
stats_temp_directory = 'pg_stat_tmp'

# More aggressive autovacuum for development
autovacuum = on
autovacuum_max_workers = 2
autovacuum_naptime = 30s               # More frequent
autovacuum_vacuum_threshold = 25       # Lower threshold
autovacuum_analyze_threshold = 25      # Lower threshold
autovacuum_vacuum_scale_factor = 0.1   # More aggressive
autovacuum_analyze_scale_factor = 0.05 # More aggressive
autovacuum_vacuum_cost_delay = 10ms    # Faster vacuum
autovacuum_vacuum_cost_limit = 100

# EXTENSIONS
#------------------------------------------------------------------------------
shared_preload_libraries = 'timescaledb,pg_stat_statements'

# TimescaleDB specific settings
timescaledb.max_background_workers = 8

# pg_stat_statements for query analysis
pg_stat_statements.max = 5000
pg_stat_statements.track = all
pg_stat_statements.save = on

# DEVELOPMENT SPECIFIC
#------------------------------------------------------------------------------
# Development-friendly settings
timezone = 'UTC'
log_timezone = 'UTC'

# Less strict settings for development
fsync = off                            # DANGER: Only for development
synchronous_commit = off               # DANGER: Only for development
full_page_writes = off                 # DANGER: Only for development

# Connection settings
tcp_keepalives_idle = 300
tcp_keepalives_interval = 30
tcp_keepalives_count = 3

# Disable SSL for development
ssl = off

# Development debugging
log_parser_stats = off
log_planner_stats = off
log_executor_stats = off
log_statement_stats = off

# Query planning
enable_seqscan = on
enable_indexscan = on
enable_bitmapscan = on