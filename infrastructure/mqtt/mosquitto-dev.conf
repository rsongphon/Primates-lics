# LICS Development MQTT Broker Configuration
# Eclipse Mosquitto Configuration for Development Environment

# =============================================================================
# General Settings
# =============================================================================

# Run as mosquitto user
user mosquitto

# Maximum number of client connections (reduced for dev)
max_connections 1000

# Maximum number of messages to hold in memory per client
max_queued_messages 100

# Maximum inflight messages per client
max_inflight_messages 20

# Memory limit for message store (MB) - smaller for dev
memory_limit 128

# =============================================================================
# Persistence Settings
# =============================================================================

# Enable persistence
persistence true
persistence_location /mosquitto/data/

# Save persistence every 300 seconds (5 minutes) - more frequent for dev
autosave_interval 300

# Save to disk if unflushed messages > 10
autosave_on_changes true

# =============================================================================
# Logging (Verbose for Development)
# =============================================================================

# Log to file and stdout for development
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout

# Log types to enable (all for development)
log_type error
log_type warning
log_type notice
log_type information
log_type debug

# Log connections and subscriptions for debugging
connection_messages true
log_dest topic

# Log timestamps
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# =============================================================================
# Default Listener (MQTT)
# =============================================================================

# MQTT listener on port 1883
listener 1883
protocol mqtt

# Maximum QoS level allowed
max_qos 2

# Allow retain messages
retain_available true

# =============================================================================
# WebSocket Listener
# =============================================================================

# WebSocket listener on port 9001
listener 9001
protocol websockets

# HTTP directory for WebSocket files
http_dir /usr/share/mosquitto/www

# =============================================================================
# Development Security Settings (Relaxed but Authenticated)
# =============================================================================

# Use authentication in dev to test production scenarios
# Set to true only for initial setup, false for production testing
allow_anonymous false

# Password file location (enabled for dev testing)
password_file /mosquitto/config/passwords.txt

# ACL file for topic-based authorization (enabled for dev testing)
acl_file /mosquitto/config/acl.txt

# Shorter ACL cache for development (faster testing of ACL changes)
acl_cache_seconds 30

# Override for quick development (uncomment to allow anonymous)
# allow_anonymous true

# =============================================================================
# Development-Friendly Settings
# =============================================================================

# Allow empty client IDs
allow_zero_length_clientid true

# No client ID prefix requirements in dev
# clientid_prefixes

# Maximum client ID length
max_clientid_len 128

# =============================================================================
# Per-client Message Limits (Relaxed for Dev)
# =============================================================================

# Maximum message size (1MB for dev testing)
message_size_limit 1048576

# Maximum topic length
max_topic_alias 65535

# Topic alias maximum
topic_alias_maximum 100

# =============================================================================
# Performance Settings (Development)
# =============================================================================

# Keep alive timeout
keepalive_timeout 300

# Disable Nagle algorithm for better performance
set_tcp_nodelay true

# SO_REUSEADDR option
so_reuseaddr true

# =============================================================================
# Statistics and Monitoring (Enabled for Dev)
# =============================================================================

# Enable $SYS topics for monitoring
sys_interval 10

# =============================================================================
# Development Topic Structure
# =============================================================================

# Development topics follow this structure:
# lics/dev/devices/{device_id}/telemetry/{metric}
# lics/dev/devices/{device_id}/commands/{command_type}
# lics/dev/devices/{device_id}/status
# lics/dev/experiments/{experiment_id}/events
# lics/dev/experiments/{experiment_id}/data
# lics/dev/system/events
# lics/dev/system/heartbeat

# =============================================================================
# Development Bridge (if testing multi-broker)
# =============================================================================

# Uncomment to bridge to another mosquitto instance for testing
# connection dev-bridge
# address localhost:1884
# topic lics/dev/bridge/# both 0 "" ""

# =============================================================================
# Development Debugging
# =============================================================================

# Enable all logging for development debugging
# trace_level debug
# websockets_log_level debug

# =============================================================================
# Development Notes
# =============================================================================

# This configuration is optimized for development:
# - Anonymous access enabled for easy testing
# - Verbose logging for debugging
# - Relaxed security settings
# - Lower resource limits
# - More frequent persistence saves
# - All monitoring topics enabled
#
# DO NOT USE THIS CONFIGURATION IN PRODUCTION!